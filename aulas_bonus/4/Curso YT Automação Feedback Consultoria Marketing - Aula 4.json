{
  "name": "Curso YT Automação Feedback Consultoria Marketing - Aula 4",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 21
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        0,
        0
      ],
      "id": "044727cc-569f-4996-aea4-ad60c1e88d96",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qbC5IiSBsy96O48KHJIQ1j-CU7ZheX650pSFphiw8zc",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 2064530308,
          "mode": "list",
          "cachedResultName": "Respostas ao formulário 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qbC5IiSBsy96O48KHJIQ1j-CU7ZheX650pSFphiw8zc/edit#gid=2064530308"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Por qual consultor você foi atendido?",
              "lookupValue": "={{ $json.Consultor }}"
            },
            {
              "lookupColumn": "Data",
              "lookupValue": "={{ $now.toFormat('dd/MM/yyyy') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        624,
        0
      ],
      "id": "ea63d25b-3b67-4736-ba14-e30a7bca62fb",
      "name": "Get row(s) in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ZZriIOrQRG9FBI7e",
          "name": "Google Sheets - Alon Hashtag Treinamentos"
        }
      }
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "average",
              "field": "Em uma escala de 1 a 10, quão satisfeito(a) você ficou com a experiência geral da consultoria de hoje?"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1.1,
      "position": [
        832,
        0
      ],
      "id": "94a7424a-c2d2-4a7d-b842-484ebf0c37d4",
      "name": "Summarize"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "306b06e9-b6fe-458f-ac78-ebc85db07d19",
              "leftValue": "={{ $json['average_Em_uma_escala_de_1_a_10,_quão_satisfeito(a)_você_ficou_com_a_experiência_geral_da_consultoria_de_hoje?'] }}",
              "rightValue": 7,
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1040,
        0
      ],
      "id": "da93aeec-49b0-4c59-8cfe-9d09468c4b8d",
      "name": "If"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Loop Over Items').item.json['E-mail'] }}",
        "subject": "=Atenção! Média de hoje abaixo de 7 ({{ $('Summarize').item.json['average_Em_uma_escala_de_1_a_10,_quão_satisfeito(a)_você_ficou_com_a_experiência_geral_da_consultoria_de_hoje?'] }})",
        "message": "={{ $('AI Agent').item.json.output }}",
        "options": {
          "appendAttribution": false,
          "attachmentsUi": {
            "attachmentsBinary": [
              {}
            ]
          }
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2528,
        -96
      ],
      "id": "3e2a271a-51c2-4aac-b28e-4cf9a5eeaccd",
      "name": "Send a message",
      "webhookId": "22cae183-7e8d-440b-badf-e0773d4dec5c",
      "credentials": {
        "gmailOAuth2": {
          "id": "hkp4uqFGGqFpwOkx",
          "name": "Gmail Conta Alon Hashtag Treinamentos"
        }
      }
    },
    {
      "parameters": {
        "operation": "xlsx",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        2320,
        -96
      ],
      "id": "43dd01c6-26ce-447f-95f6-e77e83eb9afe",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qbC5IiSBsy96O48KHJIQ1j-CU7ZheX650pSFphiw8zc",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 2064530308,
          "mode": "list",
          "cachedResultName": "Respostas ao formulário 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qbC5IiSBsy96O48KHJIQ1j-CU7ZheX650pSFphiw8zc/edit#gid=2064530308"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Por qual consultor você foi atendido?",
              "lookupValue": "={{ $('Loop Over Items').item.json.Consultor }}"
            },
            {
              "lookupColumn": "Data",
              "lookupValue": "={{ $now.toFormat('dd/MM/yyyy') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2080,
        -96
      ],
      "id": "eabc01a1-bbe2-426d-aec3-0054f8cec96e",
      "name": "Get row(s) in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ZZriIOrQRG9FBI7e",
          "name": "Google Sheets - Alon Hashtag Treinamentos"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json['concatenated_Se_houver,_quais_são_as_sugestões_de_melhoria_para_futuras_consultorias?'] }}",
        "options": {
          "systemMessage": "=Você é um Supervisor de Qualidade analisando o desempenho de um consultor.\nO objetivo é escrever um e-mail de feedback construtivo, pois a média de satisfação do dia ficou abaixo da meta (Nota < 7).\n\nENTRADA:\nVocê receberá um texto contendo todas as respostas dos clientes à pergunta \"Sugestões de melhoria\", concatenadas.\nPode haver desde zero até dezenas de comentários.\n\nINSTRUÇÕES DE ANÁLISE:\n1. Sintetize os feedbacks: Não liste cada comentário individualmente. Se houver 10 comentários sobre \"atraso\", agrupe em um único ponto de atenção.\n2. Identifique os temas principais: Foque nos padrões (ex: clareza, pontualidade, empatia, domínio técnico).\n3. Se a lista estiver vazia ou com textos irrelevantes (ex: \"não\", \"ok\"), assuma que faltou conexão com o cliente e oriente sobre proatividade.\n4. O tom deve ser profissional, direto e focado em solução (mentoria), não em punição.\n\nFORMATO DE SAÍDA:\nRetorne APENAS o código HTML do corpo do e-mail (sem tags <html>, <head> ou ```).\nUse a seguinte estrutura de tags para organizar o texto:\n- <p> para parágrafos.\n- <b> para destaques importantes.\n- <ul> e <li> para listar os principais pontos de melhoria identificados.\n\nEstrutura do conteúdo:\n1. Saudação e contexto sobre a nota do dia estar abaixo da meta.\n2. Resumo geral do sentimento dos clientes (uma visão macro baseada no que leu).\n3. Lista com os principais pontos de fricção ou melhoria citados (agrupados por tema).\n4. Uma recomendação prática e acionável para a próxima consultoria.\n5. Encerramento\n\nTente ajudar ao máximo nas análises de forma prática para a tomada de ação visando a melhoria do consultor.\n\nObservações:\n\nChame o consultor pelo nome, que está no campo {{ $('Loop Over Items').item.json.Consultor }}\nComente que está em anexo a planilha com todos os comentários e avaliações das consultorias do dia de hoje\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        1728,
        -96
      ],
      "id": "4bdac1a4-a219-4a74-9615-f9d103fbefb2",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "concatenate",
              "field": "Se houver, quais são as sugestões de melhoria para futuras consultorias?",
              "separateBy": "other",
              "customSeparator": ";\n\nPRÓXIMO FEEDBACK:"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1.1,
      "position": [
        1456,
        -96
      ],
      "id": "1adbb78d-eb9d-4a5a-b039-22f2d9fcc32e",
      "name": "Summarize1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1712,
        96
      ],
      "id": "8efcce99-a925-4400-b8fe-4b1043a7d265",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "9W06H58he36UIJSl",
          "name": "Google Gemini(PaLM) Api account 5"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json['concatenated_Se_houver,_quais_são_as_sugestões_de_melhoria_para_futuras_consultorias?'] }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1888,
        96
      ],
      "id": "2bf3a1b0-c395-490b-8d45-d52b061fa643",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qbC5IiSBsy96O48KHJIQ1j-CU7ZheX650pSFphiw8zc",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 530454039,
          "mode": "list",
          "cachedResultName": "Consultores",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qbC5IiSBsy96O48KHJIQ1j-CU7ZheX650pSFphiw8zc/edit#gid=530454039"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        208,
        0
      ],
      "id": "b4d7610f-2fab-4a50-b537-a21a1d30bc83",
      "name": "Get row(s) in sheet2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ZZriIOrQRG9FBI7e",
          "name": "Google Sheets - Alon Hashtag Treinamentos"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        416,
        0
      ],
      "id": "5e9dd2eb-dfbd-4338-a98e-0b1324aea9fd",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qbC5IiSBsy96O48KHJIQ1j-CU7ZheX650pSFphiw8zc",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 2064530308,
          "mode": "list",
          "cachedResultName": "Respostas ao formulário 1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qbC5IiSBsy96O48KHJIQ1j-CU7ZheX650pSFphiw8zc/edit#gid=2064530308"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Por qual consultor você foi atendido?",
              "lookupValue": "={{ $('Loop Over Items').item.json.Consultor }}"
            },
            {
              "lookupColumn": "Data",
              "lookupValue": "={{ $now.toFormat('dd/MM/yyyy') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1248,
        -112
      ],
      "id": "1107076b-8345-438d-8d6e-f266169de793",
      "name": "Get row(s) in sheet3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ZZriIOrQRG9FBI7e",
          "name": "Google Sheets - Alon Hashtag Treinamentos"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Summarize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet1": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize1": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet2": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet3": {
      "main": [
        [
          {
            "node": "Summarize1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "14f548d9-6589-4683-8d0d-0429e97651b0",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "937b859e6b24c13e960e67ec1eaea58b8d1affe11ea0ec3e884228716b2d6ac8"
  },
  "id": "C43tcY0eW3QbtxCP",
  "tags": []
}